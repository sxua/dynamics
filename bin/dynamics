#!/usr/bin/env ruby

def create_scaffold(name)
  if File.exists?(name)    
    puts "Error, #{name} already exists!"
  else  
    Dir.mkdir(name)
    
    controllers_dir = File.join(name, 'controllers')  
    models_dir = File.join(name, 'models')  
    views_dir = File.join(name, 'views')  
                
    Dir.mkdir(controllers_dir)    
    Dir.mkdir(models_dir)    
    Dir.mkdir(views_dir)    
    
    if File.exists?('../lib/base')
      base_controllers_dir = "../lib/base/controllers"
    else
      base_controllers_dir = "base/controllers"      
    end
        
    f = File.new(File.join(controllers_dir, 'application_controller.rb'), 'w+')   
    f.write(render_code(File.join(base_controllers_dir, 'application_controller.rb'))) 
    f.close  
  end
end

def display_usage
  str = "Dynamics is a framework for RubyMotion.\n"
  str += "\n"
  str += "Usage:\n"
  str += "  dynamics [-h, --help]\n"
  str += "  dynamics <command> [<args...>]\n"
  str += "\n"
  str += "Commands:\n"
  str += "  create   Create a new project scaffold"
  puts str
end

def render_code(name)
    f = File.open(name)     
    content = f.read
    f.close
    content
end

i = 1
for arg in ARGV
  case i
     when 1 then command = arg
     when 2 then args = arg
     else command = '-h'
  end    
  i += 1
end
case command
   when '-h', '--help' then display_usage
   when 'create' then create_scaffold(args)
   else  display_usage
end  


